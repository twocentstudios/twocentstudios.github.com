<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Images Into Music: Transformation</title>

  <meta property="og:type" content="article" />
  <meta property="og:title" content="Images Into Music: Transformation" />
  <meta property="og:url" content="https://twocentstudios.com/2016/10/12/image-into-music-transformation/" />
  
    <meta property="og:article:published_time" content="2016-10-12T01:19:33-05:00" />
  
  
  
  <link href='https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;350;400;600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://twocentstudios.com/2016/10/12/image-into-music-transformation/">
  <link rel="alternate" type="application/rss+xml" title="twocentstudios" href="https://twocentstudios.com/feed.xml" />
</head>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NE82N02W8S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NE82N02W8S');
</script>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">twocentstudios</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/blog/">Blog</a>
          
        
          
        
          
          <a class="page-link" href="/hire-me/">Hire Me</a>
          
        
          
        
          
          <a class="page-link" href="/portfolio/">Portfolio</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Images Into Music: Transformation</h1>
    <p class="post-meta">Oct 12, 2016</p>
  </header>

  <article class="post-content">
    <blockquote>
  <p>This post discusses transformers, the second module of the turning-an-image-into-an-original-piece-of-music project I outlined in <a href="http://twocentstudios.com/2016/10/10/transforming-images-into-music/">this post</a>. Skim that post first to understand the goal of the project. You can also read about the first module, deconstructors, in <a href="http://twocentstudios.com/2016/10/11/images-into-music-deconstruction/">this post</a>.</p>
</blockquote>

<p>I’ll define a transformer as the algorithm responsible for deterministically generating a musical composition based solely on a single image as the input.</p>

<p>Transformers use a palette of <a href="http://twocentstudios.com/2016/10/11/images-into-music-deconstruction/">deconstructors</a> to generate some pseudo-random numbers, then apply those numbers in a deterministic way to a decision engine. The decision engine generates a piece of music using a musical grammar and eventually creates an output in a MIDI-like DSL.</p>

<p>In this post we’ll be discussing the theory behind mapping pseudo-random data to the various decisions that must be made to create a piece of music. We’ll do so by creating an example transformer. We won’t yet discuss the MIDI-like DSL part.</p>

<h2 id="choosing-a-musical-key">Choosing a musical key</h2>

<p>Let’s start with an example of a very simple decision that must be made for our piece of music: what key will it be in?</p>

<p>In standard Western music, we have a choice of the following 12 keys:</p>

<blockquote>
  <p>C, C#, D, D#, E, F, F#, G, G#, A, A#, B</p>
</blockquote>

<p>Using 12 possible keys in our transformer will allow a variety of different sounding pieces to be created.</p>

<p>The determination of what input data we use to determine which of the 12 keys is chosen is part of the creativity and unique character of the transformer. We have several deconstructors available to us. For this example, let’s use the <code class="language-plaintext highlighter-rouge">averageGray</code> of the input image.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// Expresses a percentage 0...1 inclusive</span>
<span class="kd">typealias</span> <span class="kt">Normalized</span> <span class="o">=</span> <span class="kt">Double</span>

<span class="kd">struct</span> <span class="kt">Gray</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">gray</span><span class="p">:</span> <span class="kt">Normalized</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ImageData</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">averageGray</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Gray</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Our entire input image will be converted to grayscale, then all its values will be averaged. The final result is that we’ll have a single <code class="language-plaintext highlighter-rouge">Double</code> value constrained 0.0 to 1.0 inclusive that represents the data in this photo. A solid black image will produce 0.0, a solid white image will produce 1.0, and everything else will produce some number in between.</p>

<p>The most straightforward way to proceed from here is to create 12 equal-sized buckets along the 0.0 to 1.0 number line that correspond to each potential musical key. Whichever bucket the <code class="language-plaintext highlighter-rouge">averageGray</code> value falls into determines our key.</p>

<div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>0.0..&lt;0.083 -&gt; C
0.083..&lt;0.166 -&gt; C#
...
0.917...1.0 -&gt; B
</code></pre>
</div>

<p>For example, if the <code class="language-plaintext highlighter-rouge">averageGray</code> of our input image was <code class="language-plaintext highlighter-rouge">0.121</code>, it would fall into the second bucket above, and our resulting piece would be created in the key of C#.</p>

<p>We can even create a function that will automate this decision making process for us.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">/// Returns exactly one entry of the array based on the input.</span>
<span class="kd">func</span> <span class="n">exactlyOneOf</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">input</span><span class="p">:</span> <span class="kt">Normalized</span><span class="p">,</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kt">T</span> <span class="p">{</span> <span class="p">}</span>
</code></pre>
</div>

<p>And an example of how we’d use it:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">imageData</span><span class="p">:</span> <span class="kt">ImageData</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// converted from the input image</span>
<span class="k">let</span> <span class="nv">averageGrayValue</span><span class="p">:</span> <span class="kt">Normalized</span> <span class="o">=</span> <span class="n">imageData</span><span class="o">.</span><span class="nf">averageGray</span><span class="p">()</span><span class="o">.</span><span class="n">gray</span>
<span class="k">let</span> <span class="nv">possibleKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s">"C"</span><span class="p">,</span> <span class="s">"C#"</span><span class="p">,</span> <span class="s">"D"</span><span class="p">,</span> <span class="s">"D#"</span><span class="p">,</span> <span class="s">"E"</span><span class="p">,</span> <span class="s">"F"</span><span class="p">,</span> <span class="s">"F#"</span><span class="p">,</span> <span class="s">"G"</span><span class="p">,</span> <span class="s">"G#"</span><span class="p">,</span> <span class="s">"A"</span><span class="p">,</span> <span class="s">"A#"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">outputKey</span> <span class="o">=</span> <span class="nf">exactlyOneOf</span><span class="p">(</span><span class="n">averageGrayValue</span><span class="p">,</span> <span class="nv">items</span><span class="p">:</span> <span class="n">possibleKeys</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="probability">Probability</h2>

<p>Astute readers might notice a potential oversight in the previous algorithm related to the probability distribution of the <code class="language-plaintext highlighter-rouge">averageGray</code> function. There are a Pandora’s Box of questions we need dive into in order for our transformer to produce the “expected” results.</p>

<h3 id="should-any-key-be-more-popular-than-the-others">Should any key be more popular than the others?</h3>

<p>Or in mathematical terms, what is the probability distribution of keys based on the deconstructor we’ve chosen (in our example, <code class="language-plaintext highlighter-rouge">averageGray</code>)?</p>

<p>The answer is almost certainly that the probability distribution of all input images will not be equal across the normalized values between 0.0 and 1.0, but what will it be? And do we care?</p>

<p>For the particular example of choosing a musical key for the piece, it might not matter as much that some keys will be chosen more often than others. All musical keys will produce nominally pleasing music, if not with a slightly different character. It’s definitely a judgement call, but personally I would say we should shoot for equal distribution among our input space.</p>

<p>Which leads to the next question…</p>

<h3 id="what-is-our-input-space">What is our input space?</h3>

<p>Technically, our input space is defined as any <code class="language-plaintext highlighter-rouge">CGImage</code>. It could be a solid color, a selfie, a Renaissance painting, a landscape photo, television static, etc.</p>

<p>However, we can narrow down the expected input space considerably by targeting iOS as our eventual distribution platform, and saying a user’s camera roll is the only photo source.</p>

<p>Now we can say with some confidence that the input space will consist of some combination of photos taken by the device’s built-in camera and its captured screenshots. We can use this assumption to determine probability distributions for each of our image data deconstructors.</p>

<p>In a later post, I’ll explore using my own camera roll as an example data source to view the probability distributions of several image data deconstructors.</p>

<p>For now, let’s move on in our example transformer.</p>

<h2 id="drums">Drums</h2>

<p>Now that the key of our piece has been decided, next we need generate some drums. Well, maybe just a kick drum for now.</p>

<p>Our first decision only had one dimension so to speak (I’m playing fast and loose with the definition of dimension here). The key is static throughout the piece so we only needed to choose once between twelve options.</p>

<p>Drums, however, primarily involve a second dimension. That is: their placement on the timeline (assuming each drum hit has the same duration).</p>

<h3 id="goals">Goals</h3>

<p>We have some tradeoffs to consider in designing our algorithm. Let’s revisit our two goals for a transformer:</p>

<ul>
  <li>All pieces of music generated should be pleasing to the ear.</li>
  <li>All pieces of music should be unique.</li>
</ul>

<h3 id="strategies">Strategies</h3>

<p>There are two strategies we can consider, each playing to one of those two strengths.</p>

<ul>
  <li>Strategy A: determine at least two (but more is better) allowable patterns and use data to choose between them.</li>
  <li>Strategy B: place some constraints on which beats we can place drum hits, but otherwise allow the data to fill in the blanks.</li>
</ul>

<h4 id="strategy-a-guaranteed-musicality">Strategy A: Guaranteed Musicality</h4>

<p>Strategy A ensures that all pieces generated by this transformer will have musically valid drums because it can only choose between musically valid drum beats we’ve written in advance. We gain confidence in the musicality of the output by sacrificing entropy. The likelihood that two images produce the same drum beat is much greater than Strategy B.</p>

<p>An example of A is below. We’ve created 4 different options for drum patterns, with hits on the timeline indicated by <code class="language-plaintext highlighter-rouge">x</code> and rest beats indicated by <code class="language-plaintext highlighter-rouge">-</code>.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">x-x-x-x-</code></li>
  <li><code class="language-plaintext highlighter-rouge">x---x---</code></li>
  <li><code class="language-plaintext highlighter-rouge">x-x-x---</code></li>
  <li><code class="language-plaintext highlighter-rouge">x---x-x-</code></li>
</ol>

<h4 id="strategy-b-uniqueness">Strategy B: Uniqueness</h4>

<p>Strategy B dramatically increases the entropy (a “good” thing), at the cost of increased complexity and possibility that the generated beat will be “unmusical” (it’ll sound weird).</p>

<p>An example of B is below, specified as rules.</p>

<ol>
  <li>A hit must always occur on beat 1.</li>
  <li>A hit may occur on beats 2, 3, 4, 5, 6, 7, or 8 in any combination.</li>
</ol>

<p>It’s possible that Strategy B could produce the following patterns as well as hundreds more:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">x-------</code></li>
  <li><code class="language-plaintext highlighter-rouge">xxxxxxxx</code></li>
  <li><code class="language-plaintext highlighter-rouge">x--x-x-x</code></li>
</ul>

<p>In deciding between prebaked options like in Strategy A, and more complicated algorithms like Strategy B, it is up to the transformer’s creator to weigh the tradeoffs.</p>

<h2 id="other-instruments">Other Instruments</h2>

<p>Creating algorithms becomes even more complex as we start to introduce more of the required dimensions into our transformer.</p>

<p>A bass line generation algorithm must include logic for the following conditions and more:</p>

<ul>
  <li>the number of notes in a measure.</li>
  <li>how many unique measures are in a bar.</li>
  <li>how many unique bars are in the piece.</li>
  <li>how often each of the unique set of bars is repeated.</li>
  <li>the placement of notes on the timeline.</li>
  <li>the duration of notes might be variable (e.g. quarter-note, eighth-note).</li>
  <li>the minimum and maximum pitch of notes might fall between a specific interval (e.g. C1 to C3).</li>
  <li>the allowable pitches themselves might be constrained to a specific musical scale (e.g. major, minor, blues).</li>
  <li>the pattern might be constrained to a set of prebaked known chord progressions (e.g. 1-4-5-1, 1-6-4-5).</li>
  <li>how the bass line aligns with the other parts of the piece (e.g. drums, melody).</li>
</ul>

<p>Creating melodies and harmonies becomes even more complex since our ears will focus and follow them more closely.</p>

<h2 id="wrap-up">Wrap up</h2>

<p>In this post, we’ve looked at how we can go about using deconstructed image data to make decisions in generating our music. We looked at how to structure algorithms to create our own musical grammar. And we looked at the many dimensions we have to keep in mind when designing our algorithm.</p>

<p>In being the key creative part of this project, the strategies and success criteria are quite unbounded. I’m optimistic that the module structure around transformers and the tooling I’ve created so far will enable the creation of many interesting algorithms.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">twocentstudios</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:chris@twocentstudios.com">chris@twocentstudios.com</a></li>
          
          <li>
            <a href="https://github.com/twocentstudios">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>
          

          <li>
            <a href="https://hackyderm.io/@twocentstudios">
              <span class="icon">
                <svg viewBox="0 0 24 24">
                  <path fill="#828282" d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>

          
          <li>
            <a href="https://twitter.com/twocentstudios">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>
          
        </ul>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
