<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Goalie - A Bespoke macOS App for Time Tracking</title>

  <meta property="og:type" content="article" />
  <meta property="og:title" content="Goalie - A Bespoke macOS App for Time Tracking" />
  <meta property="og:url" content="https://twocentstudios.com/2023/10/20/goalie-time-tracking-macos/" />
  
    <meta property="og:article:published_time" content="2023-10-20T14:20:00-05:00" />
  
  
    <meta property="og:image" content="https://twocentstudios.com/images/goalie-icon.png" />
  
  
  <link href='https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;350;400;600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://twocentstudios.com/2023/10/20/goalie-time-tracking-macos/">
  <link rel="alternate" type="application/rss+xml" title="twocentstudios" href="https://twocentstudios.com/feed.xml" />
</head>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NE82N02W8S"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NE82N02W8S');
</script>

  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">twocentstudios</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/blog/">Blog</a>
          
        
          
        
          
        
          
          <a class="page-link" href="/portfolio/">Portfolio</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Goalie - A Bespoke macOS App for Time Tracking</h1>
    <p class="post-meta">Oct 20, 2023</p>
  </header>

  <article class="post-content">
    <p>I self-released a bespoke time tracking app for macOS called Goalie in July 2023. I also <a href="https://github.com/twocentstudios/goalie">open sourced</a> it. It looks like this:</p>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-main.png" width="" height="350" alt="Today view" title="Today view" /><div class="caption-text">Today view</div></div>

<p>Download the latest version directly from the GitHub <a href="https://github.com/twocentstudios/goalie/releases">releases page</a> if you want to try it out.</p>

<p>In this post I’ll give some background behind the app and a discuss a few notes about the implementation, and talk about how I created the icon.</p>

<h2 id="background">Background</h2>

<p>I created Goalie as my first bite-sized project after <a href="/2023/10/18/cookpad-retrospective/">leaving Cookpad</a> at the end of June 2023. Since I’d no longer be immersed in the Japanese language at the office every day, I wanted to make sure I was putting in a fair amount of time studying Japanese on my own.</p>

<p>I could have used one of a million time tracking apps focused on invoicing or Pomodoro, or even macOS’s built-in Screen Time feature. But this felt like a great opportunity to make a focused piece of software to my own specifications. I also wanted to do a SwiftUI-based macOS app to see where the framework was currently at. My past experience and impression from reading other developers’ thoughts was that SwiftUI on macOS has always significantly lagged behind iOS.</p>

<h2 id="how-does-it-work">How does it work?</h2>

<h3 id="start-and-stop-the-timer">Start and stop the timer</h3>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-main.png" width="" height="350" alt="Today view" title="Today view" /><div class="caption-text">Today view</div></div>

<p>Clicking start starts a new “session”. Stopping ends the session.</p>

<p>Once you reach your daily goal, the goal button lights up green.</p>

<h3 id="optionally-set-a-goal">Optionally set a goal</h3>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-set-goal.png" width="" height="350" alt="Goal view" title="Goal view" /><div class="caption-text">Goal view</div></div>

<p>Click the goal button and drag the slider to set your daily goal. Changing the goal sets the goal from that day forward until you change it again. It doesn’t affect past goals.</p>

<h3 id="show-and-edit-daily-sessions">Show and edit daily sessions</h3>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-main-expanded.png" width="" height="350" alt="Today view with sessions expanded" title="Today view with sessions expanded" /><div class="caption-text">Today view with sessions expanded</div></div>

<p>Click the “sessions today” button to show other sessions from the day. If you want to remove one, click the “x” button to its left.</p>

<h3 id="show-history">Show history</h3>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-history.png" width="" height="350" alt="History view" title="History view" /><div class="caption-text">History view</div></div>

<p>Click the calendar to show a weekly summary of your goal. Click the arrows in the header to page back through the history by weeks.</p>

<h2 id="implementation">Implementation</h2>

<h3 id="architecture">Architecture</h3>

<p>Goalie targets the SwiftUI 4 APIs (i.e. macOS 13, iOS 16).</p>

<p>I decided to go with a vanilla SwiftUI architecture that separates the view and store. The one new thing I wanted to try was pointfreeco’s <a href="https://github.com/pointfreeco/swift-dependencies">swift-dependencies</a> library to control my dependency layer.</p>

<p>Although this kind of app is often implemented as a <a href="https://developer.apple.com/design/human-interface-guidelines/the-menu-bar#Menu-bar-extras">menu bar extra</a>, I preferred a simple app window I can keep off to the corner of my big monitor. My menu bar is already too full. As an app window I can keep it in my peripheral vision or hide it behind other windows easily. If I were to formally release this app for a more general audience, I’d probably add a menu bar extra though.</p>

<p>I used a ViewData abstraction to encapsulate some of the simple synchronous logic that turns raw model data into properties ready for the view to display directly.</p>

<p>For styling, I tried to use UIKit system colors and font styles as best I could to get a classic look and dark mode support. I picked a bluish purple for the tint color. I kept branding to an absolute minimum.</p>

<p>For persistence, I made my model layer <code class="language-plaintext highlighter-rouge">Codable</code> and save it to the application support directory. The app currently only supports one “topic”, but I’ve left the door open to make it a proper document-based app that allows having multiple topics going at the same time. At the moment that goes beyond my personal use case, so I haven’t explored it any more.</p>

<h3 id="dates-and-times">Dates and times</h3>

<p>Dates and times and calendars are well known to <a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">cause headaches</a> for developers.</p>

<p>Even for what I considered to be as close to a trivial time tracking code as one could write, I still immediately ran into gotchas. Especially when I went to write the history code.</p>

<p>I think any time you start to divide hours up into days with a beginning and end, you’ve got use a calendar and time zones, of which there are many. When you want to divide days up into weeks, the problems compound.</p>

<p>It doesn’t help that many of Apple’s underlying APIs for calendars silently use the user’s current locale and more specific localization settings under the hood. This usually great, but makes it incredibly difficult to introduce complexity to your codebase slowly, and also easily test each locale.</p>

<p>I made significant use of the new Foundation formatter APIs, which, in theory, wield like a Swiss Army Knife. But in practice, there’s no official documentation, the source is completely obscured by the heavy use of generics, and you still need detailed background knowledge of how the several dozen locales affect the results. Luckily <a href="https://goshdarnformatstyle.com/">Gosh Darn Format Style!</a> helped take some of the edge off.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">/// An example of calculating and displaying the duration of an ongoing session:</span>

<span class="k">let</span> <span class="nv">now</span> <span class="o">=</span> <span class="kt">Date</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">startOfDay</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="nf">startOfDay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">now</span><span class="p">)</span>

<span class="c1">// Enumerates all sessions to calculate the total number of seconds logged for the current day up to now.</span>
<span class="k">let</span> <span class="nv">totalIntervalToday</span> <span class="o">=</span> <span class="n">topic</span><span class="o">.</span><span class="nf">totalIntervalBetween</span><span class="p">(</span><span class="nv">start</span><span class="p">:</span> <span class="n">startOfDay</span><span class="p">,</span> <span class="nv">end</span><span class="p">:</span> <span class="n">now</span><span class="p">)</span>

<span class="c1">// Convert to `Duration` type for formatting.</span>
<span class="k">let</span> <span class="nv">duration</span> <span class="o">=</span> <span class="kt">Duration</span><span class="o">.</span><span class="nf">seconds</span><span class="p">(</span><span class="n">totalIntervalToday</span><span class="p">)</span>

<span class="c1">// Produces something like 02:15:12 for a number of seconds.</span>
<span class="c1">// (This should probably explicitly reference `locale`).</span>
<span class="n">duration</span><span class="o">.</span><span class="nf">formatted</span><span class="p">(</span>
    <span class="o">.</span><span class="nf">time</span><span class="p">(</span>
        <span class="nv">pattern</span><span class="p">:</span> 
            <span class="o">.</span><span class="nf">hourMinuteSecond</span><span class="p">(</span>
                <span class="nv">padHourToLength</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
                <span class="nv">fractionalSecondsLength</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
                <span class="nv">roundFractionalSeconds</span><span class="p">:</span> <span class="o">.</span><span class="n">up</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre>
</div>

<p>What this all means is that this code is unfortunately not well tested in all locales, which is the main reason I haven’t pushed for a wide release.</p>

<h3 id="data-modeling">Data modeling</h3>

<p>I chose to model a <code class="language-plaintext highlighter-rouge">Topic</code> (the highest level model) as such:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Topic</span><span class="p">:</span> <span class="kt">Equatable</span><span class="p">,</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>

    <span class="c1">// non-nil when a session is active</span>
    <span class="k">var</span> <span class="nv">activeSessionStart</span><span class="p">:</span> <span class="kt">Date</span><span class="p">?</span> 

    <span class="c1">// assume sorted past to future</span>
    <span class="k">var</span> <span class="nv">sessions</span><span class="p">:</span> <span class="kt">IdentifiedArrayOf</span><span class="o">&lt;</span><span class="kt">Session</span><span class="o">&gt;</span> 

    <span class="c1">// assume sorted past to future, no two goals on the same day</span>
    <span class="k">var</span> <span class="nv">goals</span><span class="p">:</span> <span class="kt">IdentifiedArrayOf</span><span class="o">&lt;</span><span class="kt">Goal</span><span class="o">&gt;</span> 
<span class="p">}</span>
</code></pre>
</div>

<p>This data is relatively normalized in that I have to parse it a bit to configure the view layer. Let me show the <code class="language-plaintext highlighter-rouge">Session</code> and <code class="language-plaintext highlighter-rouge">Goal</code> models before explaining further.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Session</span><span class="p">:</span> <span class="kt">Equatable</span><span class="p">,</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>
    <span class="k">let</span> <span class="nv">start</span><span class="p">:</span> <span class="kt">Date</span>
    <span class="k">let</span> <span class="nv">end</span><span class="p">:</span> <span class="kt">Date</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">Goal</span><span class="p">:</span> <span class="kt">Equatable</span><span class="p">,</span> <span class="kt">Identifiable</span><span class="p">,</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>

    <span class="c1">// always normalized to the start of a day (this has known issues with time zone changing)</span>
    <span class="k">let</span> <span class="nv">start</span><span class="p">:</span> <span class="kt">Date</span> 

    <span class="c1">// nil intentionally unsets a goal, always &gt; 0</span>
    <span class="k">let</span> <span class="nv">duration</span><span class="p">:</span> <span class="kt">TimeInterval</span><span class="p">?</span> 
<span class="p">}</span>
</code></pre>
</div>

<p>The main consequence of logging only the start and end date of a session instead of updating the model to count up seconds is that the SwiftUI view updates independently from the model using the <code class="language-plaintext highlighter-rouge">TimelineView</code> primitive. If the computer is put to sleep or hidden, there won’t be any error in the model timekeeping. A downside is that using TimelineView offloads some necessary logic to the view layer, especially with date formatting. It’s a trade off.</p>

<p>This setup generally uses the least amount of data necessary to capture the full state and history of the system. I calculate the <code class="language-plaintext highlighter-rouge">Goal</code> moving forward in time indefinitely or until the next <code class="language-plaintext highlighter-rouge">Goal</code> object is logged. This adds some calculation burden, but it more efficient in storage. Of course, if users were allowed to, for example, insert a new goal for just one day, it would make that insertion logic slightly more complicated in the code.</p>

<p>Solving the user-can-move-time-zones problem is tough enough that I haven’t bothered. There are a couple UX questions about the “correct” behavior that aren’t immediately obvious to me.</p>

<h3 id="start-of-day">Start of day</h3>

<p>The concept of “start of the current day” is important since the count up timer is always calculated based on that point in time.</p>

<p>I thought macOS would have some sort of globally posted notification for when the day rolls over, but I couldn’t find one. One lingering issue is that my workaround code for updating that very important start-of-day value wasn’t running reliably. I’m much more familiar with the iOS app lifecycle than the macOS lifecycle so it’s unclear to me whether it’s an alarm setting error on my part, or whether the app just isn’t firing the alarm and updating the date when it’s not the key window. Either way, I added a workaround in v1.0.1 to simply ensure the start-of-day value is updated when the window is foregrounded. I recognize it’s not a perfect fix, but one step at a time.</p>

<h3 id="deployment">Deployment</h3>

<p>I haven’t set up fastlane, CI, or even Xcodegen for this project. But it’s surprisingly straightforward to do your own manual app build, signing, and distribution through GitHub. Next on the list would be a proper App Store release or Sparkle integration.</p>

<h2 id="designing-the-icon">Designing the icon</h2>

<p>I was initially tempted to use Stable Diffusion to create a low-effort app icon. However, lately I’ve been dabbling in 3D modeling with Blender and I decided to see how far I could get using it to create an icon.</p>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-icon.png" width="" height="" alt="App icon" title="App icon" /><div class="caption-text">App icon</div></div>

<p>It turns out, pretty far! I actually like this icon a lot and it didn’t take so long to put together.</p>

<p>If I were to log some more hours on it, I’d make it give it more of a macOS vibe by removing the heavy white border and try overhanging some of the foreground elements. Also I’d make some more custom low-res versions. Overall though, I find it easy to recognize in my dock when I need it.</p>

<p>Here are some more WIP shots of the design process:</p>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-icon-design-01.png" width="" height="" alt="Modeling the goal" title="Modeling the goal" /><div class="caption-text">Modeling the goal</div></div>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-icon-design-02.png" width="" height="" alt="The grass and camera position" title="The grass and camera position" /><div class="caption-text">The grass and camera position</div></div>

<div class="caption-wrapper"><img class="caption" src="/images/goalie-icon-design-03.png" width="" height="" alt="Setting up the shaders" title="Setting up the shaders" /><div class="caption-text">Setting up the shaders</div></div>

<h2 id="conclusion">Conclusion</h2>

<p>This app has been working well for me over the past month or two. It’s been great having some extra time to make some scratch-your-own-itch apps. There are plenty of ways I could improve the app, but for now, I’m satisfied with where it’s at and hope it continues to serve me well.</p>

<p>Here’s one more link to the source and releases: <a href="https://github.com/twocentstudios/goalie">twocentstudios/goalie</a>.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">twocentstudios</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li><a href="mailto:chris@twocentstudios.com">chris@twocentstudios.com</a></li>
          
          <li>
            <a href="https://github.com/twocentstudios">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>
          

          <li>
            <a href="https://hackyderm.io/@twocentstudios">
              <span class="icon">
                <svg viewBox="0 0 24 24">
                  <path fill="#828282" d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>

          
          <li>
            <a href="https://twitter.com/twocentstudios">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">twocentstudios</span>
            </a>
          </li>
          
        </ul>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
